<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ciśnienie w oponach - Pirelli</title>
  <style>
/* --- POCZĄTEK STYLE.CSS --- */
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: #181A1B;
  color: #CFFFE6;
  min-height: 100vh;
  padding: 20px;
  overflow-x: hidden;
}
.app-container {
  background: #181A1B;
  min-height: 100vh;
  width: 100%;
  max-width: 420px;
  min-width: 0;
} 
header {
  text-align: center;
  margin-bottom: 24px;
}
.logo {
  margin: 0 auto 8px auto;
}
h1 {
  color: #00FF94;
  font-size: 1.6rem;
  margin: 0 0 8px 0;
}
.form-section label {
  display: block;
  margin-top: 12px;
  margin-bottom: 4px;
  color: #fff;
  font-weight: bold;
  text-align: left;
}
.form-section select, .form-section button {
  width: 100%;
  padding: 12px;
  margin-bottom: 8px;
  border-radius: 12px;
  border: none;
  font-size: 1rem;
  background: #232526;
  color: #CFFFE6;
}
.form-section select:focus {
  outline: 2px solid #00FF94;
  box-shadow: 0 0 0 2px #00FF94;
}
.form-section button {
  background: #00FF94;
  color: #181A1B;
  font-weight: bold;
  font-size: 1.1rem;
  margin-top: 16px;
  transition: background 0.2s;
}
.form-section button:hover {
  background: #00E0FF;
  color: #181A1B;
}
.result-section > h2 {
  color: #00E0FF;
  font-size: 1.3rem;
  margin-bottom: 8px;
  margin-top: 0;
  text-align: center;
}
.results-summary {
  color: #00E0FF;
  font-size: 1.1rem;
  text-align: center;
  margin-bottom: 18px;
  letter-spacing: 0.5px;
}
.results-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 18px;
}
.result-card {
  background: #232526;
  border-radius: 18px;
  padding: 24px 10px 18px 10px;
  box-shadow: 0 2px 12px #00FF9440;
  border: 2px solid #232526;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-width: 0;
  min-height: 140px;
  transition: box-shadow 0.2s, border 0.2s;
}
.result-card:hover {
  box-shadow: 0 4px 24px #00FF9440, 0 0 8px #00E0FF44;
  border-color: #00FF94;
}
.result-label {
  color: #fff;
  font-size: 1.05rem;
  font-weight: bold;
  margin-bottom: 6px;
  letter-spacing: 0.5px;
}
.result-type {
  color: #00E0FF;
  font-size: 0.95rem;
  margin-bottom: 10px;
  letter-spacing: 0.5px;
}
.result-value {
  color: #00FF94;
  font-size: 2.5rem;
  font-weight: bold;
  margin-bottom: 4px;
  font-family: 'Consolas', 'Monaco', monospace;
  text-shadow: 0 0 8px #00FF9440;
}
.result-sub {
  color: #b0b0b0;
  font-size: 1.1rem;
  margin-bottom: 2px;
}
.result-warmers {
  color: #b0b0b0;
  font-size: 0.95rem;
  margin-top: 8px;
  font-style: italic;
  text-align: center;
  min-height: 18px;
}
.result-warmers-common {
  background: #232526;
  border-radius: 16px;
  margin: 24px auto 0 auto;
  padding: 18px 20px;
  color: #00FF94;
  font-size: 1.08rem;
  font-style: italic;
  text-align: center;
  box-shadow: 0 2px 8px #00FF9440;
  border: 2px solid #00FF94;
  max-width: 400px;
  letter-spacing: 0.5px;
}
.qrcode-section {
  margin: 32px auto 0 auto;
  text-align: center;
  padding: 18px 0 0 0;
}
.qrcode-label {
  color: #00E0FF;
  font-size: 1.08rem;
  margin-bottom: 10px;
  font-weight: bold;
  letter-spacing: 0.5px;
}
#qrcode canvas, #qrcode img {
  margin: 0 auto;
  display: block;
  background: #fff;
  border-radius: 10px;
  box-shadow: 0 2px 8px #00E0FF33;
}
.qrcode-link {
  margin-top: 14px;
  color: #00E0FF;
  font-size: 1.02rem;
  word-break: break-all;
  background: #232526;
  padding: 8px 12px;
  border-radius: 10px;
  box-shadow: 0 1px 4px #00E0FF22;
  display: inline-block;
  max-width: 90vw;
}
.copy-link-btn {
  background: #00E0FF;
  color: #181A1B;
  border: none;
  border-radius: 8px;
  padding: 10px 22px;
  font-size: 1rem;
  font-weight: bold;
  cursor: pointer;
  margin-top: 8px;
  margin-bottom: 0;
  transition: background 0.2s;
  letter-spacing: 0.5px;
}
.copy-link-btn:hover {
  background: #00b8cc;
}
.copy-link-msg {
  color: #00FF94;
  font-size: 1rem;
  margin-left: 12px;
  font-weight: bold;
}
footer {
  margin-top: auto;
  text-align: center;
  color: #00E0FF;
  font-size: 0.9rem;
  padding: 12px 0 0 0;
}
@media (max-width: 600px) {
  .results-grid {
    grid-template-columns: 1fr 1fr;
    gap: 8px;
  }
  .result-card {
    padding: 8px 2px 8px 2px;
    min-height: 60px;
    border-radius: 10px;
  }
  .result-value {
    font-size: 1.1rem;
    padding: 0;
    margin-bottom: 2px;
  }
  .result-label, .result-type, .result-sub, .result-warmers {
    font-size: 0.85rem;
  }
  .results-summary {
    font-size: 0.95rem;
  }
  .result-warmers-common {
    font-size: 0.92rem;
    padding: 8px 4px;
  }
  .qrcode-section {
    padding: 4px 0 0 0;
  }
}
.result-card, .result-value, .result-label, .result-type, .result-sub, .result-warmers {
  word-break: break-word;
  overflow-wrap: break-word;
}
@media (max-width: 480px) {
  .app-container { padding: 8px; }
  h1 { font-size: 1.2rem; }
  .result-section > h2 { font-size: 1.05rem; }
  .result-tile { font-size: 0.98rem; padding: 14px 6px 12px 6px; }
}
/* --- KONIEC STYLE.CSS --- */
  </style>
</head>
<body>
  <div class="app-container">
    <header>
      <div class="logo">
        <!-- Ikona kasku (SVG) -->
        <svg width="64" height="64" viewBox="0 0 64 64" fill="none"><path d="M10 32C10 18.7452 20.7452 8 34 8C47.2548 8 58 18.7452 58 32C58 45.2548 47.2548 56 34 56C20.7452 56 10 45.2548 10 32Z" stroke="#39FF14" stroke-width="3"/><path d="M20 32H44" stroke="#39FF14" stroke-width="3"/></svg>
      </div>
      <h1>Ciśnienie w oponach</h1>
    </header>
    <main>
      <section class="form-section">
        <label for="model">Model opony</label>
        <select id="model"></select>
        <label for="front-size">Opona przednia - rozmiar</label>
        <select id="front-size"></select>
        <label for="rear-size">Opona tylna - rozmiar</label>
        <select id="rear-size"></select>
        <button id="calculate">Oblicz ciśnienie</button>
      </section>
      <section class="result-section" id="result-section" style="display:none;">
        <div class="results-summary">
          Dla wybranego modelu i rozmiarów rekomendowane ciśnienia to:
        </div>
        <div class="results-grid">
          <div class="result-card">
            <div class="result-label">Przód</div>
            <div class="result-type">na zimno</div>
            <div class="result-value" id="cold-front-value">–</div>
            <div class="result-sub" id="cold-front-psi"></div>
            <div class="result-warmers" id="cold-front-warmers"></div>
          </div>
          <div class="result-card">
            <div class="result-label">Tył</div>
            <div class="result-type">na zimno</div>
            <div class="result-value" id="cold-rear-value">–</div>
            <div class="result-sub" id="cold-rear-psi"></div>
            <div class="result-warmers" id="cold-rear-warmers"></div>
          </div>
          <div class="result-card">
            <div class="result-label">Przód</div>
            <div class="result-type">na gorąco</div>
            <div class="result-value" id="hot-front-value">–</div>
            <div class="result-sub" id="hot-front-psi"></div>
            <div class="result-warmers" id="hot-front-warmers"></div>
          </div>
          <div class="result-card">
            <div class="result-label">Tył</div>
            <div class="result-type">na gorąco</div>
            <div class="result-value" id="hot-rear-value">–</div>
            <div class="result-sub" id="hot-rear-psi"></div>
            <div class="result-warmers" id="hot-rear-warmers"></div>
          </div>
        </div>
      </section>
      <div class="result-warmers-common" id="result-warmers-common" style="display:none;"></div>
      <div class="qrcode-section" id="qrcode-section" style="display:none;">
        <div class="qrcode-label">Udostępnij wynik przez QR:</div>
        <div id="qrcode"></div>
        <div class="qrcode-link" id="qrcode-link">
          <button id="copy-link-btn" class="copy-link-btn">Kopiuj link</button>
          <span id="copy-link-msg" class="copy-link-msg" style="display:none;">Skopiowano!</span>
        </div>
      </div>
    </main>
    <footer>
      <span id="version">Wersja 1.0</span>
    </footer>
  </div>
  <script>
/* --- POCZĄTEK APP.JS --- */
// URL do pliku CSV Pirelli (raw)
const CSV_URL = 'https://raw.githubusercontent.com/urdo/testowe/main/pirelli.csv';

function parseCSV(text) {
  const lines = text.trim().split('\n');
  const headers = lines[0].split(',');
  return lines.slice(1).map(line => {
    const values = line.split(',');
    const obj = {};
    headers.forEach((h, i) => obj[h.trim()] = values[i]?.trim() || '');
    return obj;
  });
}

async function fetchCSV() {
  const res = await fetch(CSV_URL);
  if (!res.ok) throw new Error('Nie udało się pobrać danych.');
  const text = await res.text();
  return parseCSV(text);
}

function fillDropdown(select, options) {
  select.innerHTML = '';
  options.forEach(opt => {
    const option = document.createElement('option');
    option.value = opt;
    option.textContent = opt;
    select.appendChild(option);
  });
}

let data = [];

window.addEventListener('DOMContentLoaded', async () => {
  const modelSelect = document.getElementById('model');
  const frontSizeSelect = document.getElementById('front-size');
  const rearSizeSelect = document.getElementById('rear-size');
  const calculateBtn = document.getElementById('calculate');
  const resultSection = document.getElementById('result-section');
  const resultDiv = document.getElementById('result');

  // Pobierz parametry z URL (base64 lub klasyczne)
  const urlParams = new URLSearchParams(window.location.search);
  let urlModel = urlParams.get('model');
  let urlFront = urlParams.get('front');
  let urlRear = urlParams.get('rear');
  const urlQ = urlParams.get('q');
  if (urlQ) {
    try {
      const decoded = atob(urlQ);
      const params = new URLSearchParams(decoded);
      urlModel = params.get('model');
      urlFront = params.get('front');
      urlRear = params.get('rear');
    } catch (e) {
      console.warn('Nie udało się zdekodować parametrów z base64:', e);
    }
  }

  try {
    data = await fetchCSV();
    // Wypełnij dropdown modeli
    const models = [...new Set(data.map(row => row['Model']))];
    fillDropdown(modelSelect, models);
    // Obsługa zmiany modelu
    function updateSizes() {
      const model = modelSelect.value;
      const filteredFront = data.filter(row => row['Model'] === model && row['F/R'] === 'FRONT');
      const filteredRear = data.filter(row => row['Model'] === model && row['F/R'] === 'REAR');
      const frontSizes = [...new Set(filteredFront.map(row => row['SIZE']))];
      const rearSizes = [...new Set(filteredRear.map(row => row['SIZE']))];
      fillDropdown(frontSizeSelect, frontSizes);
      fillDropdown(rearSizeSelect, rearSizes);
      if (urlFront && frontSizes.includes(urlFront)) {
        frontSizeSelect.value = urlFront;
      }
      if (urlRear && rearSizes.includes(urlRear)) {
        rearSizeSelect.value = urlRear;
      }
    }
    modelSelect.addEventListener('change', updateSizes);
    // Inicjalizacja
    if (urlModel && models.includes(urlModel)) {
      modelSelect.value = urlModel;
    }
    updateSizes();
    // Jeśli są wszystkie parametry z URL, automatycznie pokaż wynik
    if (urlModel && urlFront && urlRear && models.includes(urlModel)) {
      setTimeout(() => calculateBtn.click(), 100);
    }
  } catch (e) {
    alert(e.message);
  }

  calculateBtn.addEventListener('click', () => {
    const model = modelSelect.value;
    const frontSize = frontSizeSelect.value;
    const rearSize = rearSizeSelect.value;
    const rowFront = data.find(row =>
      row['Model'] === model &&
      row['F/R'] === 'FRONT' &&
      row['SIZE'] === frontSize
    );
    const rowRear = data.find(row =>
      row['Model'] === model &&
      row['F/R'] === 'REAR' &&
      row['SIZE'] === rearSize
    );
    // Sprawdź, czy dane warmers są identyczne i niepuste
    const warmersFront = rowFront && rowFront['TYRE WARMERS GUIDELINES'] ? rowFront['TYRE WARMERS GUIDELINES'] : '';
    const warmersRear = rowRear && rowRear['TYRE WARMERS GUIDELINES'] ? rowRear['TYRE WARMERS GUIDELINES'] : '';
    let showCommonWarmers = false;
    let commonWarmers = '';
    if (warmersFront && warmersRear && warmersFront === warmersRear) {
      showCommonWarmers = true;
      commonWarmers = warmersFront;
    }
    // Na zimno
    document.getElementById('cold-front-value').textContent = rowFront && rowFront['COLD PRESSURE [bar]'] ? rowFront['COLD PRESSURE [bar]'] : '–';
    document.getElementById('cold-front-psi').textContent = rowFront && rowFront['COLD PRESSURE [psi]'] ? rowFront['COLD PRESSURE [psi]'] + ' psi' : '';
    document.getElementById('cold-front-warmers').textContent = showCommonWarmers ? '' : warmersFront;
    document.getElementById('cold-rear-value').textContent = rowRear && rowRear['COLD PRESSURE [bar]'] ? rowRear['COLD PRESSURE [bar]'] : '–';
    document.getElementById('cold-rear-psi').textContent = rowRear && rowRear['COLD PRESSURE [psi]'] ? rowRear['COLD PRESSURE [psi]'] + ' psi' : '';
    document.getElementById('cold-rear-warmers').textContent = showCommonWarmers ? '' : warmersRear;
    // Na gorąco
    document.getElementById('hot-front-value').textContent = rowFront && rowFront['HOT PRESSURE [bar]'] ? rowFront['HOT PRESSURE [bar]'] : '–';
    document.getElementById('hot-front-psi').textContent = rowFront && rowFront['HOT PRESSURE [psi]'] ? rowFront['HOT PRESSURE [psi]'] + ' psi' : '';
    document.getElementById('hot-front-warmers').textContent = showCommonWarmers ? '' : warmersFront;
    document.getElementById('hot-rear-value').textContent = rowRear && rowRear['HOT PRESSURE [bar]'] ? rowRear['HOT PRESSURE [bar]'] : '–';
    document.getElementById('hot-rear-psi').textContent = rowRear && rowRear['HOT PRESSURE [psi]'] ? rowRear['HOT PRESSURE [psi]'] + ' psi' : '';
    document.getElementById('hot-rear-warmers').textContent = showCommonWarmers ? '' : warmersRear;
    // Kafelek wspólny
    const warmersCommonDiv = document.getElementById('result-warmers-common');
    if (showCommonWarmers) {
      warmersCommonDiv.innerHTML = `<span style="font-weight:bold; color:#fff;">Zalecenia dotyczące koców grzewczych:</span><br>${commonWarmers}`;
      warmersCommonDiv.style.display = '';
    } else {
      warmersCommonDiv.textContent = '';
      warmersCommonDiv.style.display = 'none';
    }
    resultSection.style.display = 'block';

    // QRCode
    const qrcodeSection = document.getElementById('qrcode-section');
    const qrcodeDiv = document.getElementById('qrcode');
    // Pobierz aktualne wartości z dropdownów
    const qrModel = modelSelect.value;
    const qrFront = frontSizeSelect.value;
    const qrRear = rearSizeSelect.value;
    // QRCode tylko jeśli wszystkie dane są wybrane
    if (!qrModel || !qrFront || !qrRear) {
      qrcodeSection.style.display = 'none';
      return;
    }
    // Kodowanie parametrów w base64
    const paramsString = `model=${encodeURIComponent(qrModel)}&front=${encodeURIComponent(qrFront)}&rear=${encodeURIComponent(qrRear)}`;
    const base64 = btoa(paramsString);
    const baseUrl = window.location.href.split('?')[0];
    const shareUrl = `${baseUrl}?q=${base64}`;
    // Wygeneruj QRCode (QRCode.js)
    while (qrcodeDiv.firstChild) {
      qrcodeDiv.removeChild(qrcodeDiv.firstChild);
    }
    new QRCode(qrcodeDiv, {
      text: shareUrl,
      width: 160,
      height: 160,
      colorDark: '#000000',
      colorLight: '#ffffff',
      correctLevel: QRCode.CorrectLevel.H
    });
    qrcodeSection.style.display = 'block';
    // Wyświetl przycisk kopiowania linku pod QRCode
    const qrcodeLinkDiv = document.getElementById('qrcode-link');
    const copyBtn = document.getElementById('copy-link-btn');
    const copyMsg = document.getElementById('copy-link-msg');
    // Usuwam wyświetlanie linku obok przycisku
    const linkSpan = document.getElementById('copy-link-url');
    if (linkSpan) linkSpan.remove();
    // Przechowuj aktualny link do kopiowania
    copyBtn.dataset.link = shareUrl;
    copyBtn.onclick = () => {
      navigator.clipboard.writeText(copyBtn.dataset.link).then(() => {
        copyMsg.style.display = '';
        setTimeout(() => { copyMsg.style.display = 'none'; }, 1500);
      });
    };
  });
});
/* --- KONIEC APP.JS --- */
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</body>
</html> 